{% extends "base.html" %}

{% block title %}Подробности препарата{% endblock %}

{% block content %}
<h1 class="mb-4">Подробности препарата</h1>
<div class="row">
    <div class="col-md-6">
        <div class="input-group mb-3">
            <input type="text" id="drugCodeInput" class="form-control" placeholder="Введите ATX код (например, R03AC)">
            <button class="btn btn-primary" id="loadDrugBtn">Показать</button>
        </div>
        <div id="drugInfoArea">
            <p class="text-muted">Введите ATX код и нажмите «Показать».</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const drugCodeInput = document.getElementById('drugCodeInput');
    const loadDrugBtn = document.getElementById('loadDrugBtn');
    const drugInfoArea = document.getElementById('drugInfoArea');

    function loadDrugDetails(code) {
        const atx = (code || '').trim();
        if (!atx) {
            drugInfoArea.innerHTML = '<p>Пожалуйста, введите ATX код.</p>';
            return;
        }
        drugInfoArea.innerHTML = '<p>Загрузка...</p>';
        fetch(`/drug/${encodeURIComponent(atx)}`)
            .then(r => r.json())
            .then(data => {
                const apps = data.applications || [];
                if (apps.length === 0) {
                    drugInfoArea.innerHTML = '<p>Данные не найдены.</p>';
                    return;
                }
                let html = '<div class="card"><div class="card-body">';
                html += `<h5 class="card-title">ATX код: ${data.atx_code}</h5>`;
                html += '<h6 class="mt-3">Показания:</h6><ul>';
                apps.forEach(app => {
                    html += `<li class="clickable" onclick="showApplicationDetails('${app}')">${app}</li>`;
                });
                html += '</ul></div></div>';
                drugInfoArea.innerHTML = html;
            })
            .catch(() => {
                drugInfoArea.innerHTML = '<p>Ошибка при загрузке данных.</p>';
            });
    }

    loadDrugBtn.addEventListener('click', () => loadDrugDetails(drugCodeInput.value));
    drugCodeInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            loadDrugDetails(drugCodeInput.value);
        }
    });
</script>
{% endblock %} 